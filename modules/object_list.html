<style>
    .context_object_list{
        width: 100%;
        height: 100%;
        white-space: nowrap;
        overflow: auto;
    }

    .context_object_list > ul.context{
        display: block;
        overflow: auto;
        padding: 0px;
        margin: 15px;
        box-sizing: border-box;
    }

    .context_object_list > ul.context, .object_list_item_children{
        list-style-type: none;
    }

    .object_list_item{
        margin-top: 3px;
        margin-bottom: 3px;
        color: var(--main-font-color0);
    }

    .object_list_item > div{
        float: left;
    }

    .object_list_icon > img{
        width: 15px;
        height: 15px;
        filter: invert(50%);
    }

    .object_list_name{
        margin-left: 3px;
        transition: all 0.2s ease-in-out;
    }

    .object_list_name:hover{
        cursor: pointer;
        opacity: 0.5;
    }

    .object_list_item_select > .object_list_name{
       color: var(--main-font-color1);
    }

</style>

<script type="text/javascript">
    function context_object_list(){
        let context = $("div.context_object_list").eq($("div.context_object_list").length - 1);

        let selected_id = null;

        function UpdateObject(){
            context.children(".context").html("");
            let id = 0;
            function DrawObjectList(obj, where){
                for (let i = 0; i < obj.length; i++) {
                    id += 1;
                    if(obj[i].children.length > 0){
                        where.append(`
                        <li class="object_list_item" id="` + id + `">
                            <div class="object_list_icon"><img src="res/img/` + String(obj[i].type).toLocaleLowerCase() + `.png" /></div>
                            <div class="object_list_name">` + obj[i].name + `</div>
                            <div style="clear: both"></div>
                            <ul class="object_list_item_children" id="` + id + `"></ul>
                        </li>
                        `);
                        DrawObjectList(obj[i].children, $(".object_list_item_children").eq($(".object_list_item_children").length - 1));
                    }
                    else{
                        where.append(`
                        <li class="object_list_item" id="` + id + `">
                            <div class="object_list_icon"><img src="res/img/` + String(obj[i].type).toLocaleLowerCase() + `.png" /></div>
                            <div class="object_list_name">` + obj[i].name + `</div>
                            <div style="clear: both"></div>
                        </li>
                        `);
                    }
                }
            }

            if(editor_data.data.object !== null){
                DrawObjectList(editor_data.data.object, context.children(".context"));
            }
            else{
                context.children(".context").html("Don't have objects");
            }

            $(".object_list_name").click(function(){
                if($(this).parent(".object_list_item").hasClass("object_list_item_select")){
                    $(this).parent(".object_list_item").removeClass("object_list_item_select");
                    selected_id = null;
                    editor_data_select.type = null;
                    editor_data_select.data = selected_id;
                }
                else{
                    $(".object_list_item").removeClass("object_list_item_select");
                    $(this).parent(".object_list_item").addClass("object_list_item_select");
                    selected_id = $(this).parent(".object_list_item").attr("id");
                    editor_data_select.type = "object";
                    editor_data_select.data = selected_id;
                }
            });

            $(".object_list_name").dblclick(function(){
                let obj = find_object($(this).parent().attr("id"));
                
                $(this).html(`<input class="in_ch_name_obj" type="text" value="` + $(this).html() + `">`);
                $(this).children(".in_ch_name_obj").select();
                $(this).children(".in_ch_name_obj").keypress(function (e) {
                    if(e.key == "Enter"){
                        obj.name = $(this).val();
                        $(this).parent().html($(this).val());
                    }
                }); 
            });

        }

        function UpdateSelect(){
            if(editor_data_select.data != "object" && selected_id !== null){
                selected_id = null;
                $(".object_list_item").removeClass("object_list_item_select");
            }
            if(editor_data_select.type == "object"){
                $(".object_list_item").removeClass("object_list_item_select");
                for (let i = 0; i < $(".object_list_item").length; i++) {
                    let item = $(".object_list_item").eq(i);
                    if(item.attr("id") == editor_data_select.data){
                        selected_id = Number(item.attr("id"));
                        item.addClass("object_list_item_select");
                    }
                }
            }
        }

        UpdateObject();
        editor_call_back.push(UpdateObject);
        editor_select_call_back.push(UpdateSelect);
    }
    context_object_list();
</script>

<div class="context_object_list">
    <div class="opction"></div>
    <ul class="context"></ul>
</div>